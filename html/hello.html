<html>
    <head>
        <title>Tinder</title>
        <link href="\css\hello.css" rel="stylesheet">
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
			href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;1,500&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
        />
		<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.2/mapbox-gl.css' rel='stylesheet'></link>
		<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
		<script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
		<link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
		<script type="text/javascript" src="http://iop.io/js/vendor/d3.v3.min.js"></script>
		<script type="text/javascript" src="http://iop.io/js/vendor/polymer/PointerEvents/pointerevents.js"></script>
		<script type="text/javascript" src="http://iop.io/js/vendor/polymer/PointerGestures/pointergestures.js"></script>
		<script type="text/javascript" src="http://iop.io/js/iopctrl.js"></script>

		<link rel="stylesheet" href="timescale.css" />
		<script></script>
    </head>
    <body>
        <header>
			<!--Topbar-->
            <div class="topbar">
				<span class="topbar_btn" onclick="toggleNav()">&#9776;</span>
                <a class="topbar_header" href="\html\hello.html">
                    <h1>Tindinosaurus</h1>
                </a>
                <a class=" topbar_image" href="\html\matchs.html">
                    <img src="\pictures\log.png">
				</a>
			</div>
			<!-- Sidebar -->
			<div id="mySidenav" class="sidenav">
			<h1>Filters</h1>
			<hr>
				
				<div class="slidecontainer">
					<h2><img src="/pictures/espace-reserve.png" alt="">Distance max (km) <span id="distance"></span></h2>
					<input type="range" min="1" max="1000" value="500" class="slider" id="myRange_distance">
				</div>

				<a><p>Diet</p>
					<hr>
					<div id="myBtnContainer" class = "btn_diet">
						<button class="btn active" onclick="filterSelection('carnivorous')"><img src="/pictures/viande (2).png"> Carnivore</button>
						<button class="btn" onclick="filterSelection('herbivorous')"><img src="/pictures/brocoli.png" alt=""> Herbivore</button>
						<button class="btn" onclick="filterSelection('All')"> No matters</button>
					</div>
				</a>
				
				<div class="slidecontainer">
					<h2> <img src="/pictures/la-vitesse.png" alt=""> Vitesse max (km/h) <span id="vitesse"></span></h2>
					<input type="range" min="1" max="1000" value="500" class="slider" id="myRange_vitesse">
				</div>

				<a>Espece
					<p>Reste encore à determiner comment faire</p>
				</a>

				<h1>Sélectionner la période : </h1>
				<!-- Trigger/Open The Modal -->
				<button id="myBtn" class="btnGTS">Geologic Time Scale</button>

				<!-- The Modal -->
				<div id="myModal" class="modal">

					<!-- Modal content -->
					<div class="modal-content">
						<span class="close">&times;</span>
						<div id="geoTime"></div>
						<script src="http://d3js.org/d3.v3.min.js"></script>
						<script src="timescale.js"></script>
						<script type="text/javascript">

						// Start
						timescale.init("geoTime");

						</script>
						<h3>Période sélectionnée : </h3>
						<h3>Nombre de dinosaures dans la période sélectionnée : </h3>
					</div>
				</div>
				<br>
				<br>
				<br>
			</div>
		</header>
        <main>
			<!--profile description + buttons like/superlike/no-->
            <section class = "center_container">
                    <div class="modalcard">
						<img class="modalcard-image" src="/pictures/dinos/Ankylosaurus/Ankylosaurus 2.png" alt="">
						<div class="modalcard-text">
						  <i class="fas fa-map-marker-alt" ></i>
						  <span class="date">à 130 km</span>
						  <h2>Tyrannosaurus rex</h2>
						  <hr>
						  <br>
						  <p><strong>Zone : </strong> <span>land</span></p>
						  <p><strong>Diet : </strong><span>carnivorous</span></p>
						  <p><strong>Lived : </strong><span>campanian - maastrichtian</span></p>
						</div>
						<div class="modalcard-stats">
						  <div class="stat">
							<div class="value"> <strong>Size</strong></div>
							<div class="type">12.3 m</div>
						  </div>
						  <div class="stat border">
							<div class="value"> <strong>Weight</strong></div>
							<div class="type">11073.7 kg</div>
						  </div>
						  <div class="stat">
							<div class="value"> <strong>Speed</strong></div>
							<div class="type">27.0 km/h</div>
						  </div>
						</div>
					  </div>
					  
					  <div class="buttons">
						<div class="no">
							<i class="fas fa-times"></i>
						</div>
						<div class="star">
							<i class="fas fa-star fa"></i>
						</div>
						<div class="heart">
							<i class="fas fa-heart"></i>
						</div>
					</div>
			</section>

			<!--Container map-->
            <section class = "right-container">
				<div id='map'></div>
            </section>
		</main>
        <footer>
        </footer>
    </body>
</html>

<!--JS for the map-->
<script src="https://d3js.org/d3.v3.min.js"></script>   <!-- d3.js import -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.2/mapbox-gl.js'></script>   <!-- Mapbox library import -->
<script type="text/javascript">

	// An API access token is required to use the API. Replace with your own (see how to get an API token in the slides). You can request your own on the Mapbox website

	mapboxgl.accessToken = "pk.eyJ1IjoiYWNsYXJpbnZhbCIsImEiOiJjam1wY25sNGsxOXZqM2twa2hyaG0wbDF6In0.40Fo_wy_iUZGNL5j_CIXdA";

	// A new map is created

	const map = new mapboxgl.Map({
				container: "map",   // ID of the element that contains the map
				style: "mapbox://styles/mapbox/light-v9",   // Type of map (other styles include basic-v9, streets-v9, dark-v9, satellite-v9 and bright-v9, try them out to see which one is best for your map)
				center: [4.35, 50.85],   // Coordinates of the center of the map [longitude, latitude]
				zoom: 1   // Initial zoom level (1 is the furthest zoom, it shows the whole world)
	});
		
	// Add zoom and rotation controls to the map
	
	map.addControl(new mapboxgl.NavigationControl({
		position: "top-left"}   // The controls appear at the top left
	));


	// container is the overlay of the map. The overlay will contain everything we add to the map

	const container = map.getCanvasContainer();

	// An svg is appended to the container. It will contain the visual elements

	
	const svg = d3.select(container)
		.append("svg")
			.attr("id", "points_container");   // The id of the svg is points_container
	
	//Selection des matchs
	var matchs = [{'id':"139292",'name': "Tyrannosaurus rex", 'latitude': 51.906399, 'longitude': -113.0289, 'zone':"land", 'diet':"carnivorous", 'size' : 12.9, 'weight' : 4882.3, 'speed' :27.0, 'lived' : "maastrichtian"},
	{'id':"139293", 'name': "Tyrannosaurus rex", 'latitude': 45.906399, 'longitude': -103.0289, 'zone':"land", 'diet':"carnivorous", 'size' : 12.9, 'weight' : 4882.3, 'speed' :27.0, 'lived' : "maastrichtian"}];


	d3.json("/data/fossils.json", function(data){   // The code in the function is executed only when the data is loaded. All code requiring that the data is fully loaded shoud come here

		console.log(data);   // Always check if the data was correctly loaded!

		// From this point, the code is different from the Mapbox only example

		// The points contained in data are drawn

		
		drawPoints(matchs);
		// A function drawing the points was defined. It can be called again if a different dataset needs to be drawn

		function drawPoints(points){

			// Remove the visual elements previously displayed on the map using brute force

			document.getElementById("points_container").innerHTML = "";

			// dots is the selection holding the points
			let dots = svg.selectAll(".dot")
				.data(points);

			// For each point, a circle is appended

			dots.enter().append("circle")
				.attr("class", "dot")   // The appended circles have the class dot
				.attr("r", 5)   // Radius is 5
				.append("title")   // A title is added to the circles (when the mouse goes over a circle, some text will show)
					.text(function(d){   // Text of the mouseover title
						return d["Name"];   // The text displayed for a circle is the name of museum it represents
					});
				
			// This function renders the points on the map. Basically, it handles the projection of every point

			function render(){

				// Remember that dots is a selection of points. The .attr("cx") and .attr("cy") are executed once for each circle in dots

				dots
					.attr("cx", function(d){   // Setting the x coordinate of the circle center
						
						// 1) Use the Latitude and Longitude to get a point in the Mapbox format (this point has a latitude and longitude)
						//     ----> new mapboxgl.LngLat(d.Longitude, d.Latitude)
						// 2) Compute the projection of this point. It has an x and y coordinate in pixels
						//     ----> map.project(...)
						// 3) We are setting the x coordinate of the center of the circle -> get the x coordinate of the projection
						//     ----> map.project(...).x
						return map.project(new mapboxgl.LngLat(d.longitude, d.latitude)).x;
					})
					.attr("cy", function(d){   // Setting the y coordinate of the circle center

						// 1) Use the Latitude and Longitude to get a point in the Mapbox format (this point has a latitude and longitude)
						//     ----> new mapboxgl.LngLat(d.Longitude, d.Latitude)
						// 2) Compute the projection of this point. It has an x and y coordinate in pixels
						//     ----> map.project(...)
						// 3) We are setting the y coordinate of the center of the circle -> get the y coordinate of the projection
						//     ----> map.project(...).y

						return map.project(new mapboxgl.LngLat(d.longitude, d.latitude)).y;
					});
					
			}

			// render() is called when the event viewreset of the map is triggered
			// viewreset means that the content of the layer needs to be redrawn (e.g. zoom)

			map.on("viewreset", render);

			// render() is also called when the map is moved (navigation without zoom)

			map.on("move", render);

			// render() is called once for initial placement of the points

			render();
		}
		
	});
</script>


<!--Sidebar-->
<script>function toggleNav() {
    var element = document.getElementById("mySidenav");
    if (element.style.width == "55%") {
        element.style.width = "0px";
    } else {
        element.style.width = "55%";
    }
}
</script>

<!--slider search radius-->
<script>
	var slider = document.getElementById("myRange_distance");
	var output_distance = document.getElementById("distance");
	output_distance.innerHTML = slider.value;
	
	slider.oninput = function() {
		output_distance.innerHTML = this.value;
	}
</script>

<!--slider speed -->
<script>
	var slider = document.getElementById("myRange_vitesse");
	var output_vitesse = document.getElementById("vitesse");
	output_vitesse.innerHTML = slider.value;
	
	slider.oninput = function() {
		output_vitesse.innerHTML = this.value;
	}
</script>

<script>
	filterSelection("all")
	function filterSelection(c) {
	  var x, i;
	  x = document.getElementsByClassName("filterDiv");
	  if (c == "all") c = "";
	  for (i = 0; i < x.length; i++) {
		w3RemoveClass(x[i], "show");
		if (x[i].className.indexOf(c) > -1) w3AddClass(x[i], "show");
	  }
	}
	
	function w3AddClass(element, name) {
	  var i, arr1, arr2;
	  arr1 = element.className.split(" ");
	  arr2 = name.split(" ");
	  for (i = 0; i < arr2.length; i++) {
		if (arr1.indexOf(arr2[i]) == -1) {element.className += " " + arr2[i];}
	  }
	}
	
	function w3RemoveClass(element, name) {
	  var i, arr1, arr2;
	  arr1 = element.className.split(" ");
	  arr2 = name.split(" ");
	  for (i = 0; i < arr2.length; i++) {
		while (arr1.indexOf(arr2[i]) > -1) {
		  arr1.splice(arr1.indexOf(arr2[i]), 1);     
		}
	  }
	  element.className = arr1.join(" ");
	}
	
	// Add active class to the current button (highlight it)
	var btnContainer = document.getElementById("myBtnContainer");
	var btns = btnContainer.getElementsByClassName("btn");
	for (var i = 0; i < btns.length; i++) {
	  btns[i].addEventListener("click", function(){
		var current = document.getElementsByClassName("active");
		current[0].className = current[0].className.replace(" active", "");
		this.className += " active";
	  });
	}
</script>

<script>
// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>
